

#### 操作内存

---

```
mov ax,[0]
```

`方括号`表示，里面的表达式指定的不是`立即数`，而是`偏移量`。`DS:0`中的那个`字`会被装入AX。



##### 描述内存宽度的操作符

| 操作符       | 意义                 |
| --------- | ------------------ |
| byte ptr  | 一个字节（8-bit，1 byte） |
| word ptr  | 一个字（16-bit）        |
| dword ptr | 一个双字（32-bit）       |

加减同样也可以在`[]`(取地址操作)中使用

##### 串操作

某些指令可以加上`REP`前缀，这些指令通常被叫做`串操作指令`。

`置位`、`复位`的指令分别是`STD`、`CLD`。

除了REP，常用的前缀还包括`REPNE`、`REPZ`、`REPE`、`REPNZ`等。



##### 串数据类型 

串操作指令的操作数是主存中连续存放的数据串（String）——即在连续的主存区域中，字节或字的序列 ,串操作指令的操作对象是以字（W）为单位的字串，或是以字节（B）为单位的字节串。



| 重复前缀        | 终止条件1 | 终止条件2 |
| ----------- | ----- | ----- |
| REP         | ECX=0 | 无     |
| REPE/REPZ   | ECX=0 | ZF=0  |
| REPNE/REPNZ | ECX=0 | ZF=1  |

**使用 REPE/REPZ 与 REPNE/REPNZ 前缀时，由于 CMPS 与 SCAS 指令都会根据它们的比较结果设置 ZF 标志，因此 ZF 标志不需要初始化。**



**串操作指令** 一共有5条：

+ 字符串传送指令MOVSB／MOVSW

+ 字符串比较指令CMPSB／CMPSW

+ 字符串检索指令SCASB／SCASW

+ 取字符串指令LODSB／LODSW

+ 存字符串指令STOSB／STOSW

与上面串操作指令配合使用的重复前缀有：

+ 重复 REP

+ 相等则重复/为零则重复 REPE/REPZ

+ 不相等则重复/不为零则重复 REPNE/REPNZ

在串操作指令的前面加上重复前缀，使CPU能重复执行该指令，这使处理长字符串比用软件循环处理快得多。在执行有重复前缀的串操作指令时，CX寄存器控制重复次数，每重复执行一次，CX内容减1，CX减为0结束；此外，还可以按规定的条件（ZF＝1或ZF＝0）结束重复过程。重复前缀对规定条件的检测，是在每次进入串操作以前进行的。所以若初始化使操作次数CX为0，它将不会引起任何操作。



###### 一、字符串传送指令MOVSB／MOVSW

字符串传送指令MOVSB／MOVSW将位于DS段的、由SI所指出的存储单元的内容传送到位于ES段、由DI所指的存储单元中，再修改SI和DI，从而指向下一个元素，MOVSB用于字节传送，MOVSW用于字传送。

MOVSB或MOVSW指令前面通常加重复前缀REP。重复执行的次数取决于CX寄存器的值，每次执行先检查CX内容，当CX为0则退出，不为0则将CX内容减1，然后传送一次。

###### 二、字符串比较指令CMPSB／CMPSW

字符串比较指令CMPSB／CMPSW把在DS段中由SI所指的字节或者字和在ES段中由DI所指的字节或者字相比较（相减），影响标志位，并自动修改地址指针。

CMPSB／CMPSW指令的前面常常加重复前缀REPE/REPZ 或REPNE/REPNZ。通过重复前缀的控制，利用CMPSB或者CMPSW，可以实现在两个字符串中寻找第一个不相等的元素或者第一个相等的元素。

###### 三、字符串检索指令SCASB／SCASW

使用字符串检索指令SCASB或者SCASW时，将AL中的字节或者AX中的字与位于 ES段由DI寄存器所指的内存单元的字节或字相比较（相减，影响标志位）。通过前缀，可以实现在DI所指的字符串中，寻找第一个与AL(或AX)的内容不同的字节(或字)，或者寻找第一个与AL(或 AX)的内容相同的字节(或字)。



###### 四、取字符串指令LODSB／LODSW

取字符串指令LODSB／LODSW将位于DS段由SI所指的存储单元的内容取到AL或AX中。用LODSB时，取的是字节，取完后，地址自动加1或减l；用LODSW时取的是字，取完后地址自动加2或减2。

因为使用LODSB／lODSW指令时，取来的字节或字放在AL或AX中，所以LODSB／LODSW指令前不能加前缀，否则，AL或AX中的内容会被后一次取到的内容所覆盖，最后只能得到字符串的最后1个字节或字。实际使用时，LODSB／LODSW指令一般用在循环程序中。

###### 五、存字符串指令STOSB／STOSW

存字符串指令STOSB／STOSW把AL或AX中的数存到ES段中由DI寄存器所指的内存单元，并且自动修改地址指针。加上前缀REP以后，用STOSB或STOSW指令可以使一个内存区域中填满相同的数。



